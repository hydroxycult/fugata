# Fugata Environment Configuration
# Copy this file to .env and adjust for your deployment

# ============================================================
# DATABASE
# ============================================================

# Development (SQLite)
DATABASE_URL=sqlite://./fugata.db

# Production (PostgreSQL) â€“ recommended
# DATABASE_URL=postgresql://username:password@host:port/database
# DATABASE_URL=postgresql://fugata:CHANGE_ME@localhost/fugata?sslmode=require

DB_MAX_CONNECTIONS=25
DB_QUERY_TIMEOUT_SECS=10

# ============================================================
# SECURITY KEYS (REQUIRED)
# ============================================================

# Do not use the example values below in production.
# Generate your own keys:
#   openssl rand -hex 32

PEPPER=GENERATE_WITH_openssl_rand_hex_32_REPLACE_THIS_VALUE_NOW
IP_HASH_KEY=GENERATE_WITH_openssl_rand_hex_32_REPLACE_THIS_VALUE_NOW

# ============================================================
# KMS CONFIGURATION (Choose one provider)
# ============================================================

# --- Local KMS (development only; not safe for production) ---
# Generate with: openssl rand -base64 32
KMS_PROVIDER=Local
KMS_LOCAL_KEY=GENERATE_WITH_openssl_rand_base64_32_REPLACE_THIS

# Fail-closed ensures requests are rejected if the KMS is unavailable
KMS_FAIL_CLOSED=true

# --- Vault KMS (recommended for production) ---
# KMS_PROVIDER=Vault
# VAULT_ADDR=https://vault.example.com:8200
# VAULT_TOKEN=s.xxxxxxxxxxxxxxxxxxxxxxxx
# VAULT_MOUNT=transit
# VAULT_KEY_NAME=fugata-kek
# KMS_FAIL_CLOSED=true

# --- AWS KMS (production) ---
# KMS_PROVIDER=Aws
# AWS_KMS_KEY_ID=arn:aws:kms:us-east-1:123456789:key/xxx-xxx-xxx
# AWS_REGION=us-east-1
# AWS_ACCESS_KEY_ID=AKIAxxxxxxxxx
# AWS_SECRET_ACCESS_KEY=xxxxxxxxxxxxxxxxxxxxxxxx
# KMS_FAIL_CLOSED=true

# ============================================================
# RATE LIMITING
# ============================================================

RATE_LIMIT_RPM=60
RATE_LIMIT_BURST=10

# ============================================================
# PROXY CONFIGURATION
# ============================================================

# Options: Direct, TrustedProxy, Auto
# Do not use Auto in production.
PROXY_MODE=Direct

# Required if using TrustedProxy:
# TRUSTED_PROXIES=10.0.0.1,10.0.0.2,10.0.0.0/8

# ============================================================
# SECRET SIZE LIMITS
# ============================================================

MAX_SECRET_SIZE=10485760  # 10 MB

# ============================================================
# CACHING
# ============================================================

LRU_CACHE_SIZE=1000

# ============================================================
# TTL PRESETS
# ============================================================

# Format: <number><unit> where unit = m, h, d
TTL_PRESETS=5m,1h,24h,7d,30d

# ============================================================
# ARGON2 CONFIGURATION (Deletion token hashing)
# ============================================================

ARGON2_TIME=4
ARGON2_MEMORY=65536  # 64 MB
ARGON2_PARALLELISM=1

# ============================================================
# WORKER POOL
# ============================================================

HASHER_WORKER_COUNT=4
HASHER_QUEUE_SIZE=100

# ============================================================
# SERVER
# ============================================================

PORT=8080
ENVIRONMENT=production
RUST_LOG=info

# ============================================================
# TOKEN EXPIRY
# ============================================================

DELETION_TOKEN_EXPIRY_HOURS=24
TOKEN_REPLAY_TTL_HOURS=1

# ============================================================
# CORS
# ============================================================

# ALLOWED_ORIGINS=https://frontend.example.com,https://www.example.com

# ============================================================
# QUICK START (local development)
# ============================================================

# 1. Generate keys:
#      openssl rand -hex 32        # PEPPER
#      openssl rand -hex 32        # IP_HASH_KEY
#      openssl rand -base64 32     # KMS_LOCAL_KEY
#
# 2. Set DATABASE_URL to sqlite://./fugata.db
# 3. Run migrations: sqlx migrate run
# 4. Start server: cargo run --release

# ============================================================
# PRODUCTION NOTES
# ============================================================

# - Replace all example keys (PEPPER, IP_HASH_KEY, KMS keys)
# - Use PostgreSQL instead of SQLite
# - Use Vault or AWS KMS instead of Local KMS
# - Configure PROXY_MODE and TRUSTED_PROXIES if running behind a proxy
# - Protect this file (chmod 600)
# - Prefer a secrets manager for production deployments

# ============================================================
# SECURITY WARNINGS
# ============================================================

# Do not commit real secrets to version control.
# Use strong random values, not passwords.
# Rotate keys periodically.
# Local KMS must not be used in production.
# Always run production deployments behind HTTPS.